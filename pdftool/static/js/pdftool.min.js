/*! pdftool          2015-06-05 */
var files_array,pages_array;$.event.props.push("dataTransfer"),files_array=[],pages_array=[],$(document).ready(function(){var a,b,c,d,e,f;return window.File&&window.FileReader&&window.FileList&&window.Blob?(c=function(){return $("#sortable").on("click",".fa-minus-square",function(){return confirm("Are you sure ?")?($(this).parent().remove(),f()):void 0})},f=function(){var a,b,c,d,e,f;for(pages_array=[],e=$("#sortable li"),f=[],b=c=0,d=e.length;d>c;b=++c)a=e[b],f.push(pages_array.push({filename:$(a).data("filename"),page:$(a).data("pagenum"),rotation:$(a).data("rotation")||0}));return f},d=function(){return $("#sortable").on("click",".fa-undo",function(){var a;return a=$(this).parent().data("rotation")||0,a-=90,$(this).parent().data("rotation",a),$(this).siblings("img").css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),f()}),$("#sortable").on("click",".fa-repeat",function(){var a;return a=$(this).parent().data("rotation")||0,a+=90,$(this).parent().data("rotation",a),$(this).siblings("img").css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),f()})},b=function(a){var b,c,d;return a.stopPropagation(),a.preventDefault(),d=a.dataTransfer.files,$("#drop").remove(),$("#sortable").sortable({placeholder:"ui-sortable-placeholder",start:function(a,b){return $(this).attr("data-previndex",b.item.index())},update:function(){return f()}}),b=new FormData,b.append("file",d[0]),c=d[0].name,$.ajax({url:$("#upload-button").data("preview-url"),type:"POST",cache:!1,processData:!1,contentType:!1,data:b,success:function(a){var b,d,e,g,h,i,j,k,l,m,n;for(k in a){for(h=a[k],e=atob(h),g=new Array(e.length),j=m=0,n=g.length;n>m;j=++m)i=g[j],g[j]=e.charCodeAt(j);d=new Uint8Array(g),b=new Blob([d],{type:"application/pdf"}),l=window.URL.createObjectURL(b),$("#files ul").append("<li class='pdf_thumbnail' data-filename='"+c+"' data-pagenum='"+k+"'>"+("<img src='"+l+"' />")+'<i class="fa fa-minus-square"></i><i class="fa fa-undo"></i><i class="fa fa-repeat"></i></li>')}return f()}}),files_array.push(d)},a=function(a){return a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"},e=function(a){var b,c,d,e,f,g,h;for(a.stopPropagation(),a.preventDefault(),b=new FormData,d=e=0,g=files_array.length;g>e;d=++e)c=files_array[d],b.append("files[]",c[0]);for(d=f=0,h=pages_array.length;h>f;d=++f)c=pages_array[d],b.append("pages["+d+"]['filename']",c.filename),b.append("pages["+d+"]['pagenum']",c.page),b.append("pages["+d+"]['rotation']",c.rotation);return $.ajax({url:$(this).data("url"),type:"POST",cache:!1,processData:!1,contentType:!1,data:b,beforeSend:function(){return $("#url").hide(),$("#loading").show()},success:function(a){var b,e,f,g,h,i,j;for(f=atob(a),g=new Array(f.length),d=i=0,j=g.length;j>i;d=++i)c=g[d],g[d]=f.charCodeAt(d);return e=new Uint8Array(g),b=new Blob([e],{type:"application/pdf"}),h=window.URL.createObjectURL(b),$("#url").attr("href",h),$("#url").show(),$("#loading").hide()}})}):alert("Your browser is outdated. Please consider upgrading to a newer one."),$("#files").bind("dragover",a),$("#files").bind("drop",b),$("#upload-button").bind("click",e),c(),d()});
