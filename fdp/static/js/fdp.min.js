/*! fdp          2015-06-09 */
var files_array,pages_array;$.event.props.push("dataTransfer"),files_array=[],pages_array=[],$(document).ready(function(){var a,b,c,d,e,f,g,h;return window.File&&window.FileReader&&window.FileList&&window.Blob?(a=function(){return $("#hidden-uploader").click()},d=function(a){var b,c;return c=$(a.target).attr("src"),b=a.target.cloneNode(!0),b=$(b).removeClass("thumbnail")[0],$(a.target).magnificPopup({items:{src:"<div class='centered'>"+b.outerHTML+"</div>",type:"inline"},closeBtnInside:!0})},e=function(){return $("#sortable").on("click",".fa-minus-square",function(){return confirm("Êtes-vous certain de vouloir supprimer cette page ?")?($(this).parent().remove(),h()):void 0})},h=function(){var a,b,c,d,e,f;for(pages_array=[],e=$("#sortable li"),f=[],b=c=0,d=e.length;d>c;b=++c)a=e[b],f.push(pages_array.push({filename:$(a).data("filename"),page:$(a).data("pagenum"),rotation:$(a).data("rotation")||0}));return f},f=function(){return $("#sortable").on("click",".fa-undo",function(){var a;return a=$(this).parent().data("rotation")||0,a-=90,$(this).parent().data("rotation",a),$(this).siblings("img").css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),h()}),$("#sortable").on("click",".fa-repeat",function(){var a;return a=$(this).parent().data("rotation")||0,a+=90,$(this).parent().data("rotation",a),$(this).siblings("img").css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),h()})},c=function(a){var b,c;return a.stopPropagation(),a.preventDefault(),b=(null!=(c=a.dataTransfer)?c.files:void 0)||this.files,$("#drop").remove(),$("#sortable").sortable({placeholder:"ui-sortable-placeholder",start:function(a,b){return $(this).attr("data-previndex",b.item.index())},update:function(){return h()}}),$.each(b,function(a){var c,d;return c=new FormData,c.append("file",b[a]),d=b[a].name,$.ajax({url:$("#upload-button").data("preview-url"),type:"POST",cache:!1,processData:!1,contentType:!1,data:c,xhrFields:{onprogress:function(a){return a.lengthComputable?$("#completion").progressbar({value:a.loaded/a.total*100,change:$("#progress-label").text(""+a.loaded/a.total*100+" %")}):void 0}},success:function(b){var c,e,f,g,i,j,k,l,m,n;for(a in b){for(i=b[a],f=atob(i),g=new Array(f.length),k=m=0,n=g.length;n>m;k=++m)j=g[k],g[k]=f.charCodeAt(k);e=new Uint8Array(g),c=new Blob([e],{type:"application/pdf"}),l=window.URL.createObjectURL(c),$("#files ul").append("<li class='pdf_thumbnail' data-filename='"+d+"' data-pagenum='"+a+"'>"+("<img src='"+l+"' class='thumbnail'/>")+'<i class="fa fa-minus-square"></i><i class="fa fa-undo"></i><i class="fa fa-repeat"></i></li>')}return $("#completion").fadeOut(),h()}}),files_array.push(b[a])})},b=function(a){return a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"},g=function(a){var b,c,d,e,f,g,h;for(a.stopPropagation(),a.preventDefault(),b=new FormData,d=e=0,g=files_array.length;g>e;d=++e)c=files_array[d],b.append("files[]",c);for(d=f=0,h=pages_array.length;h>f;d=++f)c=pages_array[d],b.append("pages["+d+"]['filename']",c.filename),b.append("pages["+d+"]['pagenum']",c.page),b.append("pages["+d+"]['rotation']",c.rotation);return $.ajax({url:$(this).data("url"),type:"POST",cache:!1,processData:!1,contentType:!1,data:b,beforeSend:function(){return $("#url").hide(),$("#url").css("margin-bottom","-100px"),$(".loading").show()},success:function(a){var b,e,f,g,h,i,j;if(a){for(f=atob(a),g=new Array(f.length),d=i=0,j=g.length;j>i;d=++i)c=g[d],g[d]=f.charCodeAt(d);e=new Uint8Array(g),b=new Blob([e],{type:"application/pdf"}),h=window.URL.createObjectURL(b),$("#url").attr("href",h),$("#url").show(),$("#url").animate({"margin-bottom":"0"},500)}return $(".loading").hide(1e3)}})}):alert("Your browser is outdated. Please consider upgrading to a newer one."),$("#files").bind("dragover",b),$("#files").bind("drop",c),$("#files").bind("click",a),$("#upload-button").bind("click",g),$("#hidden-uploader").bind("change",c),$("#files").on("click","*",function(a){return a.stopPropagation()}),$("#files").on("click mouseenter",".thumbnail",d),e(),f()});